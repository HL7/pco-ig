<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1" localId="0">
   <annotation translatorVersion="3.10.0" translatorOptions="EnableAnnotations,EnableLocators,DisableListDemotion,DisableListPromotion" signatureLevel="Overloads" xsi:type="a:CqlToElmInfo"/>
   <annotation xsi:type="a:Annotation">
      <a:s r="245">
         <a:s>library PHQ9MeasureExample version '0.1.0'</a:s>
      </a:s>
   </annotation>
   <identifier id="PHQ9MeasureExample" system="http://mtnlotus.com/uv/pco" version="0.1.0"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localId="1" localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="206" locator="3:1-3:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="206">
               <a:s>using </a:s>
               <a:s>
                  <a:s>FHIR</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
   </usings>
   <includes>
      <def localId="207" locator="5:1-5:35" localIdentifier="FHIRHelpers" path="http://mtnlotus.com/uv/pco/FHIRHelpers" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="207">
               <a:s>include </a:s>
               <a:s>
                  <a:s>FHIRHelpers</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="208" locator="7:1-7:39" localIdentifier="PHQ9Logic" path="http://mtnlotus.com/uv/pco/PHQ9ScoreLogic">
         <annotation xsi:type="a:Annotation">
            <a:s r="208">
               <a:s>include </a:s>
               <a:s>
                  <a:s>PHQ9ScoreLogic</a:s>
               </a:s>
               <a:s> called PHQ9Logic</a:s>
            </a:s>
         </annotation>
      </def>
   </includes>
   <parameters>
      <def localId="209" locator="9:1-9:88" name="Measurement Period" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="209">
               <a:s>parameter &quot;Measurement Period&quot; </a:s>
               <a:s r="221">
                  <a:s>Interval&lt;</a:s>
                  <a:s r="222">
                     <a:s>Date</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s> default </a:s>
               <a:s r="220">
                  <a:s r="214">Interval[@2024-01-01, @2024-12-31]</a:s>
               </a:s>
            </a:s>
         </annotation>
         <default localId="220" locator="9:55-9:88" lowClosed="true" highClosed="true" xsi:type="Interval">
            <low localId="214" locator="9:64-9:74" xsi:type="Date">
               <year localId="211" valueType="t:Integer" value="2024" xsi:type="Literal"/>
               <month localId="212" valueType="t:Integer" value="1" xsi:type="Literal"/>
               <day localId="213" valueType="t:Integer" value="1" xsi:type="Literal"/>
            </low>
            <high localId="219" locator="9:77-9:87" xsi:type="Date">
               <year localId="216" valueType="t:Integer" value="2024" xsi:type="Literal"/>
               <month localId="217" valueType="t:Integer" value="12" xsi:type="Literal"/>
               <day localId="218" valueType="t:Integer" value="31" xsi:type="Literal"/>
            </high>
         </default>
         <parameterTypeSpecifier localId="221" locator="9:32-9:45" xsi:type="IntervalTypeSpecifier">
            <pointType localId="222" locator="9:41-9:44" name="t:Date" xsi:type="NamedTypeSpecifier"/>
         </parameterTypeSpecifier>
      </def>
   </parameters>
   <contexts>
      <def localId="226" locator="11:1-11:15" name="Patient"/>
   </contexts>
   <statements>
      <def localId="224" locator="11:1-11:15" name="Patient" context="Patient">
         <expression localId="225" xsi:type="SingletonFrom">
            <operand localId="223" locator="11:1-11:15" dataType="fhir:Patient" templateId="http://hl7.org/fhir/StructureDefinition/Patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="228" locator="13:1-14:51" name="Initial Population" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="228">
               <a:s>define &quot;Initial Population&quot;:
  </a:s>
               <a:s r="229">
                  <a:s r="236">
                     <a:s>AgeInYearsAt(</a:s>
                     <a:s r="230">
                        <a:s>start of </a:s>
                        <a:s r="231">
                           <a:s>&quot;Measurement Period&quot;</a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
                  <a:s r="239"> >= 18</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="229" locator="14:3-14:51" xsi:type="GreaterOrEqual">
            <signature localId="240" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
            <signature localId="241" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
            <operand localId="236" locator="14:3-14:45" precision="Year" xsi:type="CalculateAgeAt">
               <signature localId="237" name="t:Date" xsi:type="NamedTypeSpecifier"/>
               <signature localId="238" name="t:Date" xsi:type="NamedTypeSpecifier"/>
               <operand localId="235" path="birthDate.value" xsi:type="Property">
                  <source localId="234" name="Patient" xsi:type="ExpressionRef"/>
               </operand>
               <operand localId="230" locator="14:16-14:44" xsi:type="Start">
                  <operand localId="231" locator="14:25-14:44" name="Measurement Period" xsi:type="ParameterRef"/>
               </operand>
            </operand>
            <operand localId="239" locator="14:50-14:51" valueType="t:Integer" value="18" xsi:type="Literal"/>
         </expression>
      </def>
      <def localId="243" locator="17:1-18:6" name="Measure Population" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="243">
               <a:s r="244">// Likely some condition or other relevant characteristic such as a depression diagnosis
define &quot;Measure Population&quot;:
  true</a:s>
            </a:s>
         </annotation>
         <expression localId="244" locator="18:3-18:6" valueType="t:Boolean" value="true" xsi:type="Literal"/>
      </def>
      <def localId="245" locator="28:1-29:31" name="MeasureObservation" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="245">
               <a:s>/*
Measure observation is a function defined in terms of the types of members of the measure
population, Patient in this case. In a population evaluation scenario, the measure
observation is evaluated for every member of the population.

In an individual report scenario, however, the measure observation is evaluated for
the current patient. Note that the patient context is flowing through the call here
*/
define function &quot;MeasureObservation&quot;(patient Patient):
  </a:s>
               <a:s r="249">
                  <a:s r="249">
                     <a:s r="248">
                        <a:s>PHQ9Logic</a:s>
                     </a:s>
                     <a:s>.</a:s>
                     <a:s r="249">
                        <a:s>CalculateTotalScore</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="249" locator="29:3-29:31" name="CalculateTotalScore" libraryName="PHQ9Logic" xsi:type="ExpressionRef"/>
         <operand localId="247" name="patient">
            <operandTypeSpecifier localId="246" locator="28:46-28:52" name="fhir:Patient" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
   </statements>
</library>
